<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>NoiseScape</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="sliders.css">
</head>
<body>

    <div id="columns">
        <div class="column" id="column1">
            <p class="headline">EEG Bands:</p>
            <div id="allBandsContainer">
                <div class="button" id="connectBCIButton">
                    Connect OpenBCI Board
                </div>

                <div class="bandLabelContainer">
                    <p id="deltaLabel">Delta (&#x03B4;)</p>
                    <div class="bandContainerWrapper">
                        <canvas id="deltaChart" style="width: 100%; height: 80px;"></canvas>
                    </div>
                </div>

                <div class="bandLabelContainer">
                    <p id="thetaLabel">Theta (&#x03B8;)</p>
                    <div class="bandContainerWrapper">
                        <canvas id="thetaChart" style="width: 100%; height: 80px;"></canvas>
                    </div>
                </div>

                <div class="bandLabelContainer">
                    <p id="alphaLabel">Alpha (&#x03B1;)</p>
                    <div class="bandContainerWrapper">
                        <canvas id="alphaChart" style="width: 100%; height: 80px;"></canvas>
                    </div>
                </div>

                <div class="bandLabelContainer">
                    <p id="betaLabel">Beta (&#x03B2;)</p>
                    <div class="bandContainerWrapper">
                        <canvas id="betaChart"  style="width: 100%; height: 80px;"></canvas>
                    </div>
                </div>

                <div class="bandLabelContainer">
                    <p id="gammaLabel">Gamma (&#x03B3;)</p>
                    <div class="bandContainerWrapper">
                        <canvas id="gammaChart"  style="width: 100%; height: 80px;"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="column" id="column2">
            <p class="headline">Noise Sound:</p>
                <div id="verticalSliderContainer">
                    <div class="slider-container"><input type="range" class="vertical-slider" style="--thumb-color: #ff0000;" min="0" max="100" value="50"></div>
                    <div class="slider-container"><input type="range" class="vertical-slider" style="--thumb-color: #ffa500;" min="0" max="100" value="50"></div>
                    <div class="slider-container"><input type="range" class="vertical-slider" style="--thumb-color: #ffff00;" min="0" max="100" value="50"></div>
                    <div class="slider-container"><input type="range" class="vertical-slider" style="--thumb-color: #008000;" min="0" max="100" value="50"></div>
                    <div class="slider-container"><input type="range" class="vertical-slider" style="--thumb-color: #40e0d0;" min="0" max="100" value="50"></div>
                    <div class="slider-container"><input type="range" class="vertical-slider" style="--thumb-color: #add8e6;" min="0" max="100" value="50"></div>
                    <div class="slider-container"><input type="range" class="vertical-slider" style="--thumb-color: #0000ff;" min="0" max="100" value="50"></div>
                    <div class="slider-container"><input type="range" class="vertical-slider" style="--thumb-color: #800080;" min="0" max="100" value="50"></div>
                    <div class="slider-container"><input type="range" class="vertical-slider" style="--thumb-color: #9370db;" min="0" max="100" value="50"></div>
                    <div class="slider-container"><input type="range" class="vertical-slider" style="--thumb-color: #ffc0cb;" min="0" max="100" value="50"></div>
                </div>

                <div id="volumeAndPLayRow">
                    <div class="volumeContainer" id="mainVolume">
                        <div class="sliderWrapper">
                            <input type="range" id="volumeSlider" min="1" max="9" value="5">
                        </div>
                        <span id="thumbLabel" class="thumbLabel">5</span>
                    </div>
                    <img src="assets/play.svg" class="playPauseImgInButton" id="playPauseButtonFreePlay" alt="Play/Pause">
                </div>

                <div id="definedVolumesContainer">
                    <p class="headline">Defined Volumes:</p>
                    <div id="lowVolumeContainer" class="definedVolumeContainer">
                        <p class="definedVolumeLabel">Low:</p>
                        <div class="sliderWrapper">
                            <input type="range" id="lowVolumeSlider" class="definedVolumeSlider" min="1" max="9" value="3">
                        </div>
                        <span id="lowThumbLabel" class="thumbLabel">3</span>
                    </div>
                    <div id="middleVolumeContainer" class="definedVolumeContainer">
                        <p class="definedVolumeLabel">Middle:</p>
                        <div class="sliderWrapper">
                            <input type="range" id="middleVolumeSlider" class="definedVolumeSlider" min="1" max="9" value="5">
                        </div>
                        <span id="middleThumbLabel" class="thumbLabel">5</span>
                    </div>
                    <div id="highVolumeContainer" class="definedVolumeContainer">
                        <p class="definedVolumeLabel">High:</p>
                        <div class="sliderWrapper">
                            <input type="range" id="highVolumeSlider" class="definedVolumeSlider" min="1" max="9" value="7">
                        </div>
                        <span id="highThumbLabel" class="thumbLabel">7</span>
                    </div>
                </div>

                <div id="adaptiveNoiseContainer">
                    <p class="headline adaptiveNoiseText">Adpative Noise Scape:</p>
                    <img src="assets/play.svg" class="playPauseImgInButton" id="playPauseButtonAdaptiveNoise" alt="Play/Pause">
                </div>
        </div>
        <div class="column" id="column3">
            <p class="headline">Study:</p>

           <div class="button whiteNoiseButton" id="whiteNoiseLowButton">
                White Noise | Low
                <img src="assets/play.svg" class="playPauseImgInButton">
            </div>
            <div class="button whiteNoiseButton" id="whiteNoiseMiddleButton">
                White Noise | Middle
                <img src="assets/play.svg" class="playPauseImgInButton">
            </div>
            <div class="button whiteNoiseButton" id="whiteNoiseHighButton">
                White Noise | High
                <img src="assets/play.svg" class="playPauseImgInButton">
            </div>
            <div class="button rightSkewedNoiseButton" id="rightSkewedNoiseLowButton">
                Right Skewed Noise | Low
                <img src="assets/play.svg" class="playPauseImgInButton">
            </div>
            <div class="button rightSkewedNoiseButton" id="rightSkewedNoiseMiddleButton">
                Right Skewed Noise | Middle
                <img src="assets/play.svg" class="playPauseImgInButton">
            </div>
            <div class="button rightSkewedNoiseButton" id="rightSkewedNoiseHighButton">
                Right Skewed Noise | High
                <img src="assets/play.svg" class="playPauseImgInButton">
            </div>
            <div class="button leftSkewedNoiseButton" id="leftSkewedNoiseLowButton">
                Left Skewed Noise | Low
                <img src="assets/play.svg" class="playPauseImgInButton">
            </div>
            <div class="button leftSkewedNoiseButton" id="leftSkewedNoiseMiddleButton">
                Left Skewed Noise | Middle
                <img src="assets/play.svg" class="playPauseImgInButton">
            </div>
            <div class="button leftSkewedNoiseButton" id="leftSkewedNoiseHighButton">
                Left Skewed Noise | High
                <img src="assets/play.svg" class="playPauseImgInButton">
            </div>
            
        </div>
    </div>

    <div id="row1">
        <div id="leftColumnInRow1">
            <div class="button" id="folderButton">
                Folder: /path/to/folder
            </div>
            <div class="button" id="stateToAchieveButton">
                State To Achieve: Relaxed â–¼
            </div>
        </div>
        <div id="rightColumnInRow1">
            <div class="button" id="logOnlyEEGButton">
                Log EEG (No Noise)
                <img src="assets/play.svg" class="playPauseImgInButton">
            </div>
            <div class="button" id="logEEGandNoiseButton">
                Log EEG + Noise
                <img src="assets/play.svg" class="playPauseImgInButton">
            </div>
        </div>
    </div>
    <div id="footer">
        <img src="assets/logo.png" alt="Logo" class="logo">
        <p>NoiseScape</p>
    </div>

    <div id="errorToast" class="toast"></div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        const deltaCtx = document.getElementById('deltaChart').getContext('2d');
        const thetaCtx = document.getElementById('thetaChart').getContext('2d');
        const alphaCtx = document.getElementById('alphaChart').getContext('2d');
        const betaCtx = document.getElementById('betaChart').getContext('2d');
        const gammaCtx = document.getElementById('gammaChart').getContext('2d');

        const deltaChart = new Chart(deltaCtx, createBandChartConfig());
        const thetaChart = new Chart(thetaCtx, createBandChartConfig());
        const alphaChart = new Chart(alphaCtx, createBandChartConfig());
        const betaChart = new Chart(betaCtx, createBandChartConfig());
        const gammaChart = new Chart(gammaCtx, createBandChartConfig());

        function createBandChartConfig() {
            return {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        data: [],
                        borderColor: 'white',
                        borderWidth: 2,
                        tension: 0.3,
                        fill: false
                    }]
                },
                options: {
                    animation: false,
                    responsive: true,
                    elements: {
                        point:{
                            radius: 0
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            display: false
                        },
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            };
        }

        const connectBCIButton = document.getElementById('connectBCIButton');
        const errorToast = document.getElementById('errorToast');

        let connected = false;

        function updateButtonState(state) {
            switch (state) {
                case 'connecting':
                    connectBCIButton.innerText = 'Connecting...';
                    connectBCIButton.disabled = true;
                    connectBCIButton.style.opacity = 0.5;
                    break;
                case 'connected':
                    connectBCIButton.innerText = 'Disconnect';
                    connectBCIButton.disabled = false;
                    connectBCIButton.style.opacity = 1;
                    connected = true;
                    break;
                case 'disconnected':
                    connectBCIButton.innerText = 'Connect OpenBCI Board';
                    connectBCIButton.disabled = false;
                    connectBCIButton.style.opacity = 1;
                    connected = false;
                    break;
                case 'disconnecting':
                    connectBCIButton.innerText = 'Disconnecting...';
                    connectBCIButton.disabled = true;
                    connectBCIButton.style.opacity = 0.5;
                    break;
            }
        }

        window.api.onBciConnectionPreparing(() => {
            updateButtonState('connecting');
        });

        window.api.onBciDisconnectionPreparing(() => {
            updateButtonState('disconnecting');
        });

        window.api.onBciConnectionSuccess(() => {
            updateButtonState('connected');
        });

        window.api.onBciConnectionFailed((errorMessage) => {
            updateButtonState('disconnected');
            showErrorToast(errorMessage);
        });

        window.api.onBciDisconnected(() => {
            updateButtonState('disconnected');
        });

        window.api.onBciDisconnectionFailed((errorMessage) => {
            updateButtonState('disconnected');
            showErrorToast(errorMessage);
        });

        connectBCIButton.addEventListener('click', () => {
            if (connected) {
                window.api.disconnectFromOpenBciBoard();
            } else {
                window.api.connectToOpenBciBoard();
            }
        });

        function showErrorToast(message) {
            errorToast.innerText = message;
            errorToast.classList.add('visible');
            setTimeout(() => {
                errorToast.classList.remove('visible');
            }, 5000);
        }

        function updateChart(chart, value) {
            const now = new Date().toLocaleTimeString();
            chart.data.labels.push(now);
            chart.data.datasets[0].data.push(value);

            if (chart.data.labels.length > 30) {
                chart.data.labels.shift();
                chart.data.datasets[0].data.shift();
            }
            chart.update();
        }

        window.api.onBandPowers((bandPowers) => {
            console.log("Received band powers:", bandPowers);
            updateChart(deltaChart, bandPowers.delta);
            updateChart(thetaChart, bandPowers.theta);
            updateChart(alphaChart, bandPowers.alpha);
            updateChart(betaChart, bandPowers.beta);
            updateChart(gammaChart, bandPowers.gamma);
        });
    </script>

    <script src="../src/sliders.js"></script>
    <script src="../src/renderer.js"></script>
</body>
</html>
